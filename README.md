# Система генерации коммерческих предложений для ООО "АРМАСЕТИ ИМПОРТ"

## Что это такое

Автоматизированная система для формирования коммерческих предложений на основе запросов клиентов с использованием искусственного интеллекта. Система принимает запросы на естественном языке (например, "фланец 25 мм сталь 20"), находит подходящие товары в базе данных и автоматически создает профессиональное коммерческое предложение в Excel формате.

## Как это работает

1. **Загрузка данных**: Система обрабатывает прайс-листы поставщиков (Excel/CSV файлы)
2. **ИИ-анализ**: Извлекает характеристики товаров из названий с помощью OpenAI
3. **Поиск**: Находит подходящие товары по семантическим признакам
4. **Генерация**: Создает коммерческое предложение в профессиональном Excel формате
5. **Отправка**: Доставляет КП клиенту через email

## Зависимости

### Обязательные требования
- **Python 3.10+** - основная платформа выполнения
- **OpenAI API ключ** - для обработки запросов через GPT-4

### Python библиотеки (устанавливаются автоматически)
```
fastapi==0.115.0          # Веб-фреймворк для API
uvicorn==0.30.0           # ASGI сервер
django==4.2.7             # Веб-фреймворк для админки
pandas==2.2.0             # Обработка данных
openpyxl==3.1.5           # Работа с Excel файлами
langchain                 # Фреймворк для работы с ИИ
openai==1.10.0            # API клиент OpenAI
python-dotenv==1.1.0      # Управление переменными окружения
```

## Как запустить

### 1. Подготовка окружения

```bash
# Клонирование проекта
git clone <repository-url>
cd Commercial

# Создание виртуального окружения
python -m venv venv

# Активация (Windows)
venv\Scripts\activate

# Активация (Linux/Mac)
source venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` в корневой папке проекта:

```env
# Обязательно для работы ИИ
OPENAI_API_KEY=ваш-ключ-openai

# Для отправки email (опционально)
SMTP_USER=ваш-email@gmail.com
SMTP_PASSWORD=ваш-пароль-приложения

# Дополнительные настройки
HTTP_PROXY=ваш-прокси-если-нужен
DEBUG=True
```

### 3. Запуск системы

#### Вариант A: FastAPI сервер
```bash
# Запуск API сервера
python main.py
# Или через uvicorn
uvicorn main:app --reload

# Сервер будет доступен на http://localhost:8000
```

#### Вариант B: Django веб-интерфейс
```bash
cd django_app
python manage.py migrate
python manage.py createsuperuser
python manage.py collectstatic
python manage.py runserver 8000

# Веб-интерфейс на http://localhost:8000
```

### 4. Первое использование

1. **Загрузите прайс-лист** через веб-интерфейс или API
2. **Отправьте запрос** типа "фланец 25 мм сталь 20"
3. **Получите готовое КП** в Excel формате

## API Endpoints

### Генерация предложения
```http
POST /generate-proposal
Content-Type: application/json

{
    "query": "фланец 25 мм сталь 20",
    "email": "client@example.com"
}
```

### Загрузка прайс-листа
```http
POST /upload-price-list
Content-Type: application/json

{
    "file_path": "путь/к/прайс-листу.xlsx"
}
```

## Структура проекта

```
Commercial/
├── main.py                    # FastAPI сервер
├── proposal_generator.py      # Генерация Excel КП
├── sender.py                  # Отправка через email
├── logger.py                  # Система логирования
├── django_app/                # Django веб-интерфейс
│   ├── products/              # Управление товарами
│   └── templates/             # HTML шаблоны
├── proposals/                 # Готовые КП (Excel)
└── uploads/                   # Загруженные прайс-листы
```

## Примеры запросов

**Простые запросы:**
- "фланец 25 мм"
- "отводы стальные 90 градусов"  
- "заглушки Ду 50"

**Сложные запросы:**
- "Фланцы плоские ст.20 исп.В Ду 25 ГОСТ 33259-2015"
- "Отводы крутоизогнутые 90° ст.20 159х4.5"

## Решение проблем

**Ошибка API ключа OpenAI:**
- Проверьте правильность ключа в `.env`
- Убедитесь что у ключа есть доступ к GPT-4

**Ошибки загрузки Excel:**
- Используйте файлы с расширением .xlsx, .xls или .csv
- Убедитесь что в файле есть колонки с наименованием и ценой

**Нет подходящих товаров:**
- Проверьте что прайс-лист загружен
- Попробуйте более простой запрос
- Убедитесь что товары есть в базе данных 