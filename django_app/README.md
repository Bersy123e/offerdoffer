# Коммерческие предложения для сантехнического оборудования (Django)

## Описание
Веб-система для автоматизации формирования коммерческих предложений (КП) по базе товаров сантехнического оборудования с поддержкой загрузки прайсов от разных поставщиков, поиска по клиентским запросам и генерации КП в PDF.

## Основные функции
- Загрузка прайс-листа (Excel/CSV) с поддержкой "шахматки" и выбором поставщика
- Автоматическое обновление товаров по поставщику (старые данные стираются)
- Извлечение характеристик из наименований и клиентских запросов (категория, диаметр, материал, давление и др.)
- Поиск товаров по текстовому запросу клиента
- Вывод результатов поиска с указанием поставщика, цены, характеристик
- (В процессе) Генерация КП в PDF и сохранение истории запросов/КП
- (В процессе) Просмотр и скачивание истории запросов и КП

## Текущий прогресс
- [x] Django-проект и приложение `products`
- [x] Модели: Supplier, Product, SearchQuery, Proposal, SearchCache
- [x] Админка для управления товарами и поставщиками
- [x] Загрузка прайс-листа с парсингом "шахматки"
- [x] Очистка старых товаров по поставщику при загрузке
- [x] Форма поиска по клиентскому запросу, извлечение характеристик, вывод результатов
- [ ] Генерация КП в PDF
- [ ] История запросов и КП, просмотр и скачивание
- [ ] Кэширование типовых запросов
- [ ] Интеграция с ИИ (OpenAI, LangChain) для уточнения поиска
- [ ] Тестирование полного цикла

## Структура
- `products/models.py` — модели товаров, поставщиков, истории, КП, кэша
- `products/views.py` — загрузка прайса, поиск, (будет) генерация КП
- `products/templates/products/` — шаблоны загрузки прайса, поиска, (будет) КП и история
- `products/urls.py` — маршруты загрузки, поиска и др.
- `commercial/settings.py` — настройки проекта

## Как работает
1. **Загрузка прайса:**
   - Менеджер выбирает поставщика и загружает Excel/CSV-файл.
   - Старые товары этого поставщика удаляются, новые добавляются.
2. **Поиск:**
   - Вводится текстовый запрос клиента (например, "Отвод 90°630х8 ст20").
   - Система извлекает характеристики и ищет подходящие товары по базе.
   - Результаты выводятся с указанием поставщика, цены и характеристик.
3. **(В процессе) Генерация КП:**
   - По найденным товарам формируется КП в PDF.
   - КП и история запроса сохраняются для последующего анализа.

## Планы
- Доработать генерацию КП в PDF (WeasyPrint)
- Реализовать просмотр и скачивание истории запросов и КП
- Добавить кэширование и интеграцию с ИИ для уточнения поиска
- Провести тестирование полного цикла

---

**Проект ведётся по ТЗ из чата. Все этапы и решения фиксируются в этом README.** 

from weasyprint import HTML 

HTML(string=html_string).write_pdf(tmp.name) 