{% extends 'products/base_dashboard.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<style>
.card {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border: none;
    margin-bottom: 20px;
}

.card-header {
    background: linear-gradient(45deg, #3498db, #2980b9);
    color: white;
    font-weight: 600;
}

.progress-bar {
    background: linear-gradient(45deg, #3498db, #2980b9);
}

.badge {
    font-size: 0.9em;
}

.text-muted {
    font-size: 0.9em;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã "–ê–†–ú–ê–°–ï–¢–ò –ò–ú–ü–û–†–¢"</h2>
            <p class="text-muted">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: {{ analytics.generated_at }}</p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5 class="card-title">üì¶ –¢–æ–≤–∞—Ä—ã –≤ –±–∞–∑–µ</h5>
                    <h3>{{ analytics.database_stats.total_products }}</h3>
                    <small>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">üè™ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</h5>
                    <h3>{{ analytics.database_stats.total_suppliers }}</h3>
                    <small>–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5 class="card-title">üìã –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h5>
                    <h3>{{ analytics.proposal_stats.total_proposals }}</h3>
                    <small>–ó–∞ {{ analytics.proposal_stats.period_days }} –¥–Ω–µ–π</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <h5 class="card-title">üîç –ü–æ–∏—Å–∫–∏</h5>
                    <h3>{{ analytics.search_stats.total_searches }}</h3>
                    <small>–ü–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</small>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <td>–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:</td>
                            <td><strong>{{ analytics.proposal_stats.start_date }} - {{ analytics.proposal_stats.end_date }}</strong></td>
                        </tr>
                        <tr>
                            <td>–í—Å–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:</td>
                            <td><strong>{{ analytics.proposal_stats.total_proposals }}</strong></td>
                        </tr>
                        <tr>
                            <td>–¢–æ–≤–∞—Ä–æ–≤ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö:</td>
                            <td><strong>{{ analytics.proposal_stats.total_products_in_proposals }}</strong></td>
                        </tr>
                        <tr>
                            <td>–°—Ä–µ–¥–Ω–µ–µ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –ö–ü:</td>
                            <td><strong>{{ analytics.proposal_stats.avg_products_per_proposal|floatformat:1 }}</strong></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üì¶ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã —Ç–æ–≤–∞—Ä–æ–≤</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <td>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:</td>
                            <td><strong>{{ analytics.database_stats.total_products }}</strong></td>
                        </tr>
                        <tr>
                            <td>–¢–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏:</td>
                            <td><strong>{{ analytics.database_stats.products_with_prices }}</strong></td>
                        </tr>
                        <tr>
                            <td>–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞ –Ω–µ–¥–µ–ª—é:</td>
                            <td><strong>{{ analytics.database_stats.recent_additions }}</strong></td>
                        </tr>
                        <tr>
                            <td>–ü–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤:</td>
                            <td><strong>{{ analytics.database_stats.total_suppliers }}</strong></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–æ–ø –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üè™ –¢–æ–ø –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</h5>
                </div>
                <div class="card-body">
                    {% if analytics.top_suppliers %}
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                                    <th>–¢–æ–≤–∞—Ä–æ–≤</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for supplier in analytics.top_suppliers %}
                                <tr>
                                    <td>{{ supplier.name }}</td>
                                    <td><span class="badge badge-primary">{{ supplier.product_count }}</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞—Ö</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üîç –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h5>
                </div>
                <div class="card-body">
                    {% if analytics.popular_searches %}
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>–ó–∞–ø—Ä–æ—Å</th>
                                    <th>–ü–æ–∏—Å–∫–æ–≤</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for search in analytics.popular_searches %}
                                <tr>
                                    <td>{{ search.query_text }}</td>
                                    <td><span class="badge badge-info">{{ search.search_count }}</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∏—Å–∫–∞—Ö</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º -->
    {% if analytics.supplier_distribution %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º</h5>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤</th>
                                <th>–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—â–µ–≥–æ</th>
                                <th>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for supplier in analytics.supplier_distribution %}
                            <tr>
                                <td><strong>{{ supplier.name }}</strong></td>
                                <td>{{ supplier.product_count }}</td>
                                <td>{{ supplier.percentage }}%</td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" role="progressbar" 
                                             style="width: {{ supplier.percentage }}%"
                                             aria-valuenow="{{ supplier.percentage }}" 
                                             aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –±—É–¥—É—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-secondary">
                <div class="card-header bg-light">
                    <h5 class="text-muted">üöß –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>üìà –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h6>
                            <ul class="text-muted">
                                <li>–ì—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏</li>
                                <li>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤</li>
                                <li>–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>üìä –û—Ç—á–µ—Ç—ã</h6>
                            <ul class="text-muted">
                                <li>PDF –æ—Ç—á–µ—Ç—ã</li>
                                <li>Excel —ç–∫—Å–ø–æ—Ä—Ç</li>
                                <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h6>
                            <ul class="text-muted">
                                <li>–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã</li>
                                <li>–§–∏–ª—å—Ç—Ä—ã –ø–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º</li>
                                <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary" disabled>
                    üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel (—Å–∫–æ—Ä–æ)
                </button>
                <button type="button" class="btn btn-outline-secondary" disabled>
                    üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç (—Å–∫–æ—Ä–æ)
                </button>
                <button type="button" class="btn btn-outline-info" disabled>
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–∫–æ—Ä–æ)
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %} 